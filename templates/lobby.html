{% extends "base.html" %}

{% block title %}Salon d'attente - C'est Trop Dur{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/lobby.css') }}">
{% endblock %}

{% block body %}
<div class="lobby-container">
  <div class="lobby-card glass-card animate-fade-in">
    <h1 class="game-title" style="font-size: 2.5rem;">Salon d'attente</h1>

    <div class="room-code-box">
      <div class="room-code-label">Code de la partie</div>
      <div class="room-code-value">{{ room.code }}</div>
    </div>

    <div class="share-box">
      Partagez ce code avec vos amis pour qu'ils rejoignent
      <div class="share-link">{{ request.host_url }}join</div>
    </div>

    <div class="voice-box">
      <button id="voiceBtn" class="voice-btn muted" onclick="toggleVoice()">Activer le micro</button>
      <span class="voice-status" id="voiceStatus">Chat vocal desactive</span>
    </div>

    <h2 class="section-title">Joueurs connectes</h2>
    <div class="player-count">
      <span id="currentPlayers">{{ room.players|length }}</span> / {{ room.max_players }} joueurs
    </div>

    <div class="players-list" id="playersList">
      {% for pid, pname in room.players.items() %}
      <div class="player-item">
        <div class="player-item-avatar">{{ pname[0]|upper }}</div>
        <span class="player-item-name">{{ pname }}</span>
        {% if pid == room.host_player_id %}
        <span class="badge badge-gold host-badge">HOTE</span>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div class="start-area">
      {% if player_id == room.host_player_id %}
      <button id="startBtn" class="btn btn-primary btn-full" onclick="startGame()"
              {% if room.players|length < 3 %}disabled{% endif %}>
        Demarrer la partie
      </button>
      <p class="waiting-message" id="waitingMsg"
         {% if room.players|length >= 3 %}style="display:none;"{% endif %}>
        En attente d'au moins 3 joueurs...
      </p>
      {% else %}
      <p class="waiting-message">En attente que l'hote demarre la partie...</p>
      {% endif %}

      <a href="/" class="btn btn-secondary btn-full" style="margin-top: 12px;">Quitter le salon</a>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const roomCode = '{{ room.code }}';
  const isHost = {{ 'true' if player_id == room.host_player_id else 'false' }};
</script>
<script src="{{ url_for('static', filename='js/lobby.js') }}"></script>
{% endblock %}
